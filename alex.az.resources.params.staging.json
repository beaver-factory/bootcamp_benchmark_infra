{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "ResourceGroupName": {
      "value": "alexBootcampBenchmarkStaging"
    },
    "StorageAccountName": {
      "value": "bootcampbstorageaccstag2"
    },
    "BlobContainer1": {
      "value": "rawblobcontainer"
    },
    "BlobContainer2": {
      "value": "processedblobcontainer"
    },
    "FunctionAppName": {
      "value": "bootcampbfuncappstag2"
    },
    "adminLogin": {
      "value": "bootcampb_admin"
    },
    "adminPassword": {
      "value": "secret_password123"
    },
    "PostgresServerName": {
      "value": "bootcampbpsqlserverstag2"
    },
    "PostgresDBName": {
      "value": "bootcampbpsqldbstag"
    },
    "KeyVaultName": {
      "value": "bootcampbkeyvaultstag2"
    },
    "KeyVaultEnabledForDeployment": {
      "value": false
    },
    "KeyVaultEnabledForDiskEncryption": {
      "value": false
    },
    "KeyVaultEnabledForTemplateDeployment": {
      "value": false
    },
    "SkuName": {
      "value": "standard"
    },
    "AppRegistrationSPObjectID": {
      "value": "f37e41fb-5bd7-419f-9a55-ef97077bc858"
    },
    "DevGroupObjId": {
      "value": "a67a2672-8b1e-487a-8485-9076bf501ec1"
    },
    "TimeZone": {
      "value": "Europe/London"
    },
    "ExceptionAlertName": {
      "value": "exceptionAlert"
    },
    "ExceptionAlertDescription": {
      "value": "Alerts users when a function fails to run correctly (i.e when an exception is raised)"
    },
    "ExceptionAlertSeverity": {
      "value": 1
    },
    "ExceptionAlertFrequency": {
      "value": "PT15M"
    },
    "ExceptionAlertTimeWindow": {
      "value": "PT15M"
    },
    "ExceptionAlertThreshold": {
      "value": 0
    },
    "ExceptionActionGroupName": {
      "value": "exceptionAlerts"
    },
    "ExceptionActionGroupShortName": {
      "value": "excAlerts"
    },
    "ExceptionActionGroupEmails": {
      "value": [
        {
          "name": "powerAutomateEmailAlert",
          "serviceUri": "https://prod-27.uksouth.logic.azure.com:443/workflows/b61f03a573534af9b9702cf50161bc25/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=KDBfTIaGGu-z17_LmQQeQNW9etMVxcPIFGTbs4xD0_o",
          "useCommonAlertSchema": true
        }
      ]
    },
    "ExceptionQueryObj": {
      "value": {
        "query": "union traces | union exceptions| where timestamp > ago(15m) | where operation_Name != '' | where type != '' | order by timestamp asc | project timestamp, message = iff(message != '', message, iff(innermostMessage != '', innermostMessage, customDimensions.['prop__{OriginalFormat}'])), logLevel = 'Error', operation_Name, type",
        "metricMeasureColumn": "AggregatedValue",
        "dimensions": [],
        "operator": "GreaterThan",
        "name": "exceptionAlert",
        "metricName": "exceptions/count",
        "threshold": "[parameters('ExceptionAlertThreshold')]",
        "timeAggregation": "Count",
        "criterionType": "StaticThresholdCriterion"
      }
    }
  }
}
